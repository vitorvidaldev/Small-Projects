# Amazon Virtual Private Cloud (Amazon VPC)

Amazon Virtual Private Cloud (Amazon VPC) gives you full control over your virtual networking environment, including resource placement, connectivity, and security. Get started by setting up your VPC in the AWS service console. Next, add resources to it such as Amazon Elastic Compute Cloud (EC2) and Amazon Relational Database Service (RDS) instances. Finally, define how your VPCs communicate with each other across accounts, Availability Zones, or AWS Regions.

Amazon Virtual Private Clound (VPC) is a service that lets you launch AWS resources in a logically isolated virtual network that you define. You have complete control over your virtual networking environment, including selection of your own IP address range, creation of subnets, and configuration of route tables and network gateways. You can use both IPv4 and IPv6 for most resources in your VPC, helping to ensure secure and easy access to resources and applications.

- VPC Endpoints help keep traffic between AWS services within the AWS Network
- There are two kinds of VPC Endpoints. Interface Endpoints and Gateway Endpoints
- Interface Endpoints cost money, Gateway Endpoints are free
- Interface Endpoints users an Elastic Network Interface (ENI) with Private IP (powered by AWS PrivateLink)
- Gateway Endpoints is a target for a specific route in your route table
- Interface Endpoints support many AWS services
- Gateway Endpoint only support DynamoDB and S3

You can monitor your VPC flow logs delivered to Amazon Simple Storage Service (Amazon S3) or Amazon CloudWatch to gain operational visibility into your network dependencies and traffic patterns, detect anomalies and prevent data leakage, and troubleshoot network connectivity and configuration issues. The enriched metadata in flow logs helps you learn more about who initiated your TCP connections and the packet-level source and destination for traffic flowing through intermediate layers (such as a NAT gateway). You can also archive your flow logs to assis in meeting certain compliance requirements.

- VPC Flow Logs monitor the in-and-out traffic of your Network Interfaces within your VPC
- You can turn on Flow Logs at the VPC, Subnet or Network Interface level
- VPC flow Logs cannot be tagged like other AWS resources
- You cannot change the configuration of a flow log after it's created.
- You cannot enable flow logs for VPCs which are peered with your VPC unless it is in the same account
- VPC Flow Logs can be delivered to an S3 or CloudWatch Logs
- VPC Flow Logs contains the source and destination IP addresses (not hostnames)
- Some instance traffic is not monitored:
  - Instance traffic generated by contacting the AWS DNS servers
  - Windows license activation traffic from instances
  - Traffic to and from the instance metadata address (169.254.169.254)
  - DHCP traffic
  - Any traffic to the reserved IP address of the default VPC router

A network access control list (network ACL) is an optional layer of security for your VPC that acts as a firewall for controlling traffic in and out of one or more subnets. You might set up network ACLs with rules similar to those of your security groups.

- Network Access Control List is commonly known as NACL
- VPCs are automatically given a default NACL which allows all outbound and inbound traffic.
- Each subnet within a VPC must be associated with a NACL.
- Subnets can only be associated with 1 NACL at a time. Associating a subnet with a new NACL will remove the previous association.
- If a NACL is not explicitly associated with a subnet, the subnet will automatically be associated with the default NACL.
- NACL has inbound and outbound rules (just like Security Groups).
- Rules can either allow or deny traffic. (Unlike Security Groups which can only allow)
- NACLs are stateless (any allowed inbound traffic is also allowed outbound)
- When you create a NACLs it will deny all traffic by default
- NACLs contain a numbered list of rules that gets evaluated in order from lowerst to highest.
- If you needed to block a single IP address you could via NACLs (Security Groups cannot deny)

Create security groups to act as a firewall for associated Amazon EC2 instances, controlling inbound and outbound traffic at the instance level. Whe you launch an instance, you can associate it with one or more security groups. If you don't specify a group, the instance is automatically associated with the VPC's default group. Each instance in your VPC can belong to a different set of groups.

- Security Groups acts as a firewall at the instance level
- Unless allowed specifically, all inbound traffic is blocked by default
- All outboud traffic from the instance is allowed by default
- You can specific for the source to be either an IP range, single IP address or another security group
- Security Groups are stateful (if traffic is allowed inbound it is also allowed outbound)
- Any changes to a Security Group take effect immediately
- EC2 Instances can belong to multiple security groups
- Security groups can contain multiple EC2 Instances
- You cannot block specific IP addresses with Security Groups, for this you would need a Network Access Control List (NACL)
- You can have up to 10,000 Security Groups per Region (default 2,500)
- You can have 60 inbound and 60 outbound rules per Security Group
- You can have 16 Security Groups associated to an ENI (default is 5)

- When creating a NAT instance you must disable source and destination checks on the instance
- NAT instances must exist in a public subnet
- You must have a route out of the private subnet to the NAT instance
- The size of a NAT instance determines how much traffic can be handled
- High availability can be achieved using Autoscaling Groups, multiple subnets in different AZs, and automate failover between them using a script
- NAT Gateways are redundant inside an Availability Zone
- You can only have 1 NAT Gateway inside 1 Availability Zone
- Starts at 5 Gbps and scales all the way you to 45 Gbps
- NAT Gateways are the preferred setup for enterprise systems.
- There is no requirement to patch NAT Gateways, and there is no need to disable Source/Destination checks for the NAT Gateway
- NAT Gateways are automatically assigned a public IP address
- Route Tables for the NAT Gateway MUST be updated
- Resources in multiple AZs sharing a Gateway will lose internet access if the Gateway goes down, unless you create a Gateway in each AZ and configure route tables accordingly